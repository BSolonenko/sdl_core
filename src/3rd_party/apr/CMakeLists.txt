if(NOT FORCE_APR_BUILD)
  SDL_find_package(apr)
endif()

if(TARGET apr::apr)
  set(apr_FOUND ON)
  return()
endif()

set(APR_SOURCE_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/apr-1.5.0)
set(APR_BUILD_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/apr-build)
set(APR_INCLUDE_DIRECTORY ${APR_SOURCE_DIRECTORY}/include)
set(APR_LIBS_DIRECTORY ${APR_BUILD_DIRECTORY}/.libs)

file(MAKE_DIRECTORY
  ${APR_BUILD_DIRECTORY}/include/private
  ${APR_SOURCE_DIRECTORY}/include/private
)

file(COPY ${APR_SOURCE_DIRECTORY}/tools/gen_test_char.c
  DESTINATION ${APR_BUILD_DIRECTORY}/tools
)

include("./${PLATFORM}.cmake")

add_library(apr::apr UNKNOWN IMPORTED GLOBAL)
set_target_properties(apr::apr
  PROPERTIES
    INTERFACE_INCLUDE_DIRECTORIES "${APR_INCLUDE_DIRECTORY}"
    IMPORTED_LOCATION "${APR_LIBS_DIRECTORY}/libapr-1.so"
)

set(apr_FOUND ON)

install(
  DIRECTORY ${APR_LIBS_DIRECTORY}/
  DESTINATION ${3RD_PARTY_INSTALL_PREFIX_ARCH}/lib
  USE_SOURCE_PERMISSIONS
  FILES_MATCHING PATTERN libapr-1.so*
)

install(
  DIRECTORY ${APR_INCLUDE_DIRECTORY}/
  DESTINATION ${3RD_PARTY_INSTALL_PREFIX}/include
  USE_SOURCE_PERMISSIONS
  FILES_MATCHING PATTERN *.h
)